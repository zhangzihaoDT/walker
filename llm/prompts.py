#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Prompts定义模块 - 存储所有的提示词模板
"""

# 意图识别提示词
INTENT_RECOGNITION_PROMPT = """
你是一个智能助手，负责识别用户的意图。请分析用户的问题，优先判断为直接查询类型。

用户问题类型：
1. 直接查询类 (query_only)：【默认优先】包含数据查询、业务查询、具体信息获取等
2. 数据分析类 (data_analysis)：明确要求复杂分析、报告生成、统计建模等
3. 一般对话类 (general_chat)：普通聊天、问候、其他非数据相关问题

判断规则（按优先级排序）：
1. **优先识别为query_only**：
   - 销量、上险、品牌、车型、地区等业务数据查询
   - 使用"查询"、"查找"、"筛选"、"搜索"、"过滤"、"多少"、"哪些"等查询词汇
   - 包含具体条件的数据获取请求（如时间、地点、类别等）
   - 询问具体数值、排名、对比等信息

2. **仅在明确要求时识别为data_analysis**：
   - 明确要求"分析"、"建模"、"预测"、"趋势分析"
   - 要求生成"报告"、"洞察"、"深度分析"
   - 需要复杂统计计算或机器学习的任务

3. **其他为general_chat**：普通对话、问候等

**重要**：当不确定时，默认选择query_only，让SQL Agent处理具体的业务查询

请严格按照以下JSON格式返回结果，不要添加任何其他内容：

示例1 - 直接查询类：
{{
    "intent": "query_only",
    "confidence": 0.9,
    "reason": "用户使用查询关键词进行精确查询",
    "need_data_analysis": false
}}

示例2 - 数据分析类：
{{
    "intent": "data_analysis",
    "confidence": 0.9,
    "reason": "用户询问数据相关信息",
    "need_data_analysis": true
}}

示例3 - 一般对话类：
{{
    "intent": "general_chat",
    "confidence": 0.8,
    "reason": "普通对话问题",
    "need_data_analysis": false
}}

用户问题：{user_question}

请返回JSON格式的结果：
"""

# 数据分析结果解释提示词
DATA_ANALYSIS_EXPLANATION_PROMPT = """
你是一个专业的数据分析师，请根据数据分析结果回答用户的问题。

用户问题：{user_question}

数据分析结果：
{analysis_result}

请用通俗易懂的语言解释数据分析结果，回答用户的问题。要求：
1. 直接回答用户的问题
2. 用简洁明了的语言描述数据特征
3. 如果有多个数据集，请分别介绍
4. 突出重要的数据指标和发现
5. 保持专业但友好的语调

回答：
"""

# 一般对话提示词
GENERAL_CHAT_PROMPT = """
你是一个友好的AI助手，专门帮助用户了解和分析数据。

当前可用的数据分析功能：
- 数据概览：查看数据的基本信息、形状、列名等
- 数据统计：获取数值列的统计信息
- 数据质量：检查缺失值、数据类型等

用户问题：{user_question}

请友好地回答用户的问题，如果用户询问数据相关内容，可以引导他们使用具体的数据查询语句。

回答：
"""

# 错误处理提示词
ERROR_HANDLING_PROMPT = """
在数据分析过程中出现了错误，请帮助用户理解问题并提供解决建议。

用户问题：{user_question}
错误信息：{error_message}

请用友好的语言解释可能的原因，并提供解决建议。

回答：
"""

# 销量查询参数提取提示词
SALES_QUERY_PARAMETER_EXTRACTION_PROMPT = """
你是一个专业的汽车销量查询参数提取助手。请从用户问题中智能提取查询参数。

用户问题: {user_question}

请提取以下参数并以JSON格式返回：

{{
    "brands": ["品牌名称列表"],
    "model_names": ["车型名称列表"],
    "provinces": ["省份列表"],
    "cities": ["城市列表"],
    "fuel_types": ["燃料类型列表"],
    "start_date": "开始日期(YYYY-MM-DD)",
    "end_date": "结束日期(YYYY-MM-DD)",
    "limit": 数量限制(整数),
    "time_granularity": "时间粒度(year/month/day)"
}}

参数提取规则：

1. **品牌识别**：
   - 主流品牌：智己、特斯拉、比亚迪、蔚来、理想、小鹏、宝马、奔驰、奥迪、丰田、本田、大众等
   - 注意品牌的完整性，如"智己"不要拆分

2. **车型识别**：
   - 智己系列：智己LS6、智己LS7、智己L7等
   - 特斯拉系列：特斯拉Model S、特斯拉Model 3、特斯拉Model Y、特斯拉Model X等
   - 蔚来系列：蔚来ES6、蔚来ES8、蔚来ET7、蔚来ET5等
   - 理想系列：理想ONE、理想L9、理想L8、理想L7等
   - 小鹏系列：小鹏P7、小鹏P5、小鹏G9、小鹏G6等
   - 比亚迪系列：比亚迪汉、比亚迪唐、比亚迪宋、比亚迪秦等

3. **时间范围识别**：
   - 具体年份："2024年" -> start_date: "2024-01-01", end_date: "2024-12-31"
   - 具体月份："2024年3月" -> start_date: "2024-03-01", end_date: "2024-03-31"
   - 季度："2024年第一季度" -> start_date: "2024-01-01", end_date: "2024-03-31"
   - 半年："2024年上半年" -> start_date: "2024-01-01", end_date: "2024-06-30"
   - 半年："2024年下半年" -> start_date: "2024-07-01", end_date: "2024-12-31"
   - 相对时间："今年"、"去年"、"最近一年"等需要根据当前时间计算
   - 时间范围："2023-2024年" -> start_date: "2023-01-01", end_date: "2024-12-31"

4. **燃料类型识别**：
   - 纯电动：明确提及"纯电动"、"电动车"等
   - 插电式混合动力：明确提及"插电式"、"PHEV"等
   - 混合动力：明确提及"混动"、"HEV"等
   - 新能源汽车：包含["纯电动", "插电式混合动力"]两种类型
   - 汽油、柴油、氢燃料等其他类型

5. **地区识别**：
   - 省份/直辖市：北京市、上海市、天津市、重庆市、广东省、浙江省、江苏省等
   - 注意："北京"、"上海"等简称应识别为对应的省份/直辖市（如"北京"->"北京市"）
   - 城市：深圳市、杭州市、南京市、广州市等地级市

6. **数量限制**："前10名"、"TOP5"、"最多20个"等

7. **时间粒度推断**：
   - 年度查询（如"2024年销量"）-> "year"
   - 月度查询（如"3月销量"、"每月销量"）-> "month"
   - 日度查询（如"每日销量"、"昨天销量"）-> "day"

**重要示例**：
- "新能源汽车前10名" -> fuel_types: ["纯电动", "插电式混合动力"]
- "北京市纯电动汽车销量" -> provinces: ["北京市"], fuel_types: ["纯电动"]
- "北京纯电动汽车销量" -> provinces: ["北京市"], fuel_types: ["纯电动"]

注意事项：
- 如果某个参数在问题中没有明确提及，请设为null或不包含该字段
- 时间范围要准确，避免过度推断
- 品牌和车型要区分清楚，不要混淆
- 新能源汽车必须包含纯电动和插电式混合动力两种类型
- 地区简称要转换为完整名称（北京->北京市）
- 只返回JSON格式，不要其他解释文字

只返回JSON，不要其他解释。
"""

# AI洞察生成提示词
AI_INSIGHTS_GENERATION_PROMPT = """
基于销量数据生成3个关键洞察：

数据：{query_data}
查询参数：{query_params}
用户问题：{user_question}

要求：
1. 每个洞察1-2句话
2. 突出关键数据和趋势
3. 简洁专业

格式：
* 洞察标题: 具体内容

"""